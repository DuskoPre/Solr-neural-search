services:
  solr:
    image: solr:9.4.1
    ports:
      - "8983:8983"
    environment:
      - SOLR_HEAP=1g
    # Use built-in _default configset to precreate the core
    command: >
      bash -c "solr-precreate ms-marco /opt/solr/server/solr/configsets/_default && solr-foreground"
    volumes:
      - ./solr-data:/var/solr
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8983/solr/admin/cores?action=STATUS"]
      interval: 30s
      timeout: 10s
      retries: 5

  neural-search-app:
    build: .
    depends_on:
      - solr
    environment:
      - SOLR_URL=http://solr:8983/solr/ms-marco
    volumes:
      - ./data:/app/data
      - ./scripts:/app/scripts
    working_dir: /app
    command: ["bash","-lc","tail -f /dev/null"]   # <â€” keep container alive
    stdin_open: true
    tty: true
